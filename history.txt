#V2
UPDATE thoughts 
UPDATE thoughts SET chain_id = "20251104-Session2-Handoff" WHERE chain_id IS NULL AND created_at >= "2025-11-04T00:00:00Z" AND created_at <= "2025-11-04T23:59:59Z";
SELECT meta::id(id) as id, created_at FROM thoughts WHERE created_at >= "2025-11-04" ORDER BY created_at DESC LIMIT 15;
UPDATE thoughts SET chain_id = "20251104-Session2-Handoff" WHERE chain_id IS NULL AND created_at >= "2025-11-05T02:01:00Z" AND created_at <= "2025-11-05T02:04:00Z";
SELECT meta::id(id) as id, chain_id FROM thoughts WHERE id = "5849aa6a-e146-4e35-8d99-9aa88cf77856";
SELECT * FROM thoughts:`5849aa6a-e146-4e35-8d99-9aa88cf77856`;
UPDATE thoughts:`5849aa6a-e146-4e35-8d99-9aa88cf77856`, thoughts:`586307a0-32bd-4e22-8360-9158795a50a5`, thoughts:`7f7a6458-e8ac-419a-bfc0-f65638939af0`, thoughts:`a65462c2-852a-49f4-b408-e3d46eef68a8`, thoughts:`20c3349c-0e3e-4ee4-b1db-5a3d4a6ff658`, thoughts:`00769c65-60ad-4d37-bf95-db6aee82f5ad`, thoughts:`5c3cc68b-2b8a-4ac5-a302-0d8d1cd532ba`, thoughts:`d6ae892b-cac4-4724-8660-2939fe5ad5fb`, thoughts:`5c04092b-8a86-47ae-af71-24c305e5cc18`, thoughts:`fbfdbf18-fe78-4362-b81e-ac2af9fbd1be` SET chain_id = "20251104-Session2-Handoff";
SELECT count() FROM thoughts GROUP ALL; SELECT * FROM thoughts WHERE extracted_to_kg = false LIMIT 5;
SELECT count() FROM thoughts GROUP ALL; SELECT count() FROM thoughts WHERE extracted_to_kg = false GROUP ALL; SELECT * FROM thoughts LIMIT 3;
SELECT extracted_to_kg FROM thoughts LIMIT 1;
SELECT * FROM thoughts LIMIT 1;
SELECT id, content, created_at, embedding, access_count FROM thoughts LIMIT 1;
SELECT id, content FROM thoughts LIMIT 1;
USE NS legacymind DB ops; SELECT id, content, created_at, embedding, injected_memories, injection_scale, significance, access_count, last_accessed, submode, framework_enhanced, framework_analysis, embedding_model, embedding_provider, embedding_dim, embedded_at, extracted_to_kg, extraction_batch_id FROM thoughts WHERE extracted_to_kg = false LIMIT 1;
USE NS legacymind DB ops; SELECT count() FROM thoughts;
INFO FOR KV;
USE NS surreal_mind DB ops; SELECT count() FROM thoughts;
USE NS surreal_mind DB ops; INFO FOR DB;
USE NS legacymind DB ops; INFO FOR DB;
USE NS photography DB ops; INFO FOR DB;
USE NS surreal_mind DB conciousness; SELECT count() FROM thoughts;
USE NS surreal_mind DB conciousness; INFO FOR DB;
USE NS surreal_mind DB consciousness; INFO FOR DB;
USE NS surreal_mind DB consciousness; SELECT count() FROM thoughts;
USE NS surreal_mind DB consciousness; SELECT id, content, created_at, embedding, injected_memories, injection_scale, significance, access_count, last_accessed, submode, framework_enhanced, framework_analysis, embedding_model, embedding_provider, embedding_dim, embedded_at, extracted_to_kg, extraction_batch_id FROM thoughts LIMIT 1;
SELECT job_id, status, metadata, started_at, completed_at FROM agent_jobs WHERE job_id = 'f3922eb8-952c-4d58-a26d-0b876417bf52';
UPDATE agent_jobs SET metadata = { prompt: 'hi' } WHERE job_id = 'f3922eb8-952c-4d58-a26d-0b876417bf52';
SELECT job_id, status, prompt, task_name, model_override, cwd, timeout_ms FROM agent_jobs WHERE job_id = '3018cb9d-f9fa-4470-aa55-3570f860c452';
SELECT job_id, status, created_at, prompt, task_name FROM agent_jobs ORDER BY created_at DESC LIMIT 5;
INFO FOR TABLE agent_jobs;
SELECT job_id, status, prompt, task_name, model_override, cwd, timeout_ms FROM agent_jobs WHERE job_id = 'b1019a85-24df-43e6-b078-fb31c0411f21';
CREATE agent_jobs SET job_id = 'ec575f65-ea29-4675-b666-6cc5d3faca43', tool_name = 'delegate_gemini', agent_source = 'gemini', agent_instance = 'gemini-2.5-pro', prompt = 'Reply with \\'ok\\' only.', task_name = 'sm-ff-test', model_override = NONE, cwd = NONE, timeout_ms = 15000, status = 'queued', created_at = time::now();
SELECT job_id, status, started_at, completed_at, duration_ms, error FROM agent_jobs WHERE job_id = 'ec575f65-ea29-4675-b666-6cc5d3faca43';
CREATE agent_jobs SET job_id = '47c24a87-02a3-4b21-9a12-15f01a351487', tool_name = 'delegate_gemini', agent_source = 'gemini', agent_instance = 'gemini-2.5-pro', prompt = 'Reply with \\'ok\\' only.', task_name = 'sm-ff-test', model_override = NONE, cwd = NONE, timeout_ms = 15000, status = 'queued', created_at = time::now();
SELECT job_id, status, started_at, completed_at, duration_ms, error FROM agent_jobs WHERE job_id = '47c24a87-02a3-4b21-9a12-15f01a351487';
CREATE agent_jobs SET job_id = '4ab1be77-b871-4984-ab11-124422915175', tool_name = 'delegate_gemini', agent_source = 'gemini', agent_instance = 'gemini-2.5-pro', prompt = 'Reply with \\'ok\\' only.', task_name = 'sm-ff-test', model_override = NONE, cwd = NONE, timeout_ms = 15000, status = 'queued', created_at = time::now();
SELECT job_id, status, started_at, completed_at, duration_ms, error FROM agent_jobs WHERE job_id = '4ab1be77-b871-4984-ab11-124422915175';
CREATE agent_jobs SET job_id = '70195f94-22df-4d4b-94e0-559dbbee93a1', tool_name = 'delegate_gemini', agent_source = 'gemini', agent_instance = 'gemini-2.5-pro', prompt = 'Reply with \\'ok\\' only.', task_name = 'sm-ff-test', model_override = NONE, cwd = NONE, timeout_ms = 15000, status = 'queued', created_at = time::now();
SELECT job_id, status, started_at, completed_at, duration_ms, error FROM agent_jobs WHERE job_id = '70195f94-22df-4d4b-94e0-559dbbee93a1';
SELECT job_id, status, started_at, completed_at, duration_ms, error, session_id, exchange_id FROM agent_jobs WHERE job_id = '70195f94-22df-4d4b-94e0-559dbbee93a1';
CREATE agent_jobs SET job_id = '69082954-32bc-4377-b2dc-8af4c6271e3d', tool_name = 'delegate_gemini', agent_source = 'gemini', agent_instance = 'gemini-2.5-pro', prompt = 'Reply with \\'ok\\' only.', task_name = 'sm-ff-test', model_override = NONE, cwd = NONE, timeout_ms = 15000, status = 'queued', created_at = time::now();
SELECT job_id, status, started_at, completed_at, duration_ms, error, session_id, exchange_id FROM agent_jobs WHERE job_id = '69082954-32bc-4377-b2dc-8af4c6271e3d';
REMOVE FIELD exchange_id ON TABLE agent_jobs; DEFINE FIELD exchange_id ON TABLE agent_jobs TYPE option<string>;
CREATE agent_jobs SET job_id = 'cae742ef-96f8-4601-b644-5ba7246e589d', tool_name = 'delegate_gemini', agent_source = 'gemini', agent_instance = 'gemini-2.5-pro', prompt = 'Reply with \\'ok\\' only.', task_name = 'sm-ff-test', model_override = NONE, cwd = NONE, timeout_ms = 15000, status = 'queued', created_at = time::now();
SELECT job_id, status, started_at, completed_at, duration_ms, error, session_id, exchange_id FROM agent_jobs WHERE job_id = 'cae742ef-96f8-4601-b644-5ba7246e589d';
SELECT meta::id(id) as id, content, created_at FROM thoughts WHERE extracted_to_kg = false ORDER BY created_at ASC LIMIT 1
SELECT count() FROM thoughts WHERE extracted_to_kg = false GROUP ALL
UPDATE thoughts SET extracted_to_kg = false WHERE id = (SELECT id FROM thoughts LIMIT 1)[0].id; SELECT meta::id(id) as id, content, created_at FROM thoughts WHERE extracted_to_kg = false LIMIT 1
SELECT count() FROM thoughts GROUP ALL
CREATE thoughts SET content = 'Test thought for KG extraction', extracted_to_kg = false, created_at = time::now()
SELECT id, content FROM thoughts WHERE id = thoughts:51036026 OR id = thoughts:a4175663 OR id = thoughts:3222945d OR id = thoughts:3f3e4d1b OR id = thoughts:9bf2ddf3;
INFO FOR DB;
SELECT id, content FROM thoughts LIMIT 10;
SELECT id, content FROM thoughts WHERE type::string(id) CONTAINS '51036026' OR type::string(id) CONTAINS 'a4175663' OR type::string(id) CONTAINS '3222945d' OR type::string(id) CONTAINS '3f3e4d1b' OR type::string(id) CONTAINS '9bf2ddf3';
INFO FOR TABLE agent_jobs;
INFO FOR NS;
SELECT * FROM agent_jobs:f2qirhluiux9nkyocs47;
SELECT count() AS count FROM agent_jobs WHERE status = 'queued' AND (prompt IS NONE OR prompt = '' OR prompt IS NULL OR type::is::string(prompt) = false);
SELECT count() AS count FROM agent_jobs WHERE status = 'queued' AND (prompt IS NONE OR prompt = '' OR prompt IS NULL OR type::is::string(prompt) = false) GROUP ALL;
SELECT job_id, exchange_id FROM agent_jobs WHERE exchange_id IS NOT NONE LIMIT 5;
SELECT status, count() AS count FROM agent_jobs GROUP BY status;
SELECT id, job_id, status, prompt, task_name, created_at, started_at FROM agent_jobs WHERE status = 'running' LIMIT 10;
SELECT id, job_id, status, prompt, task_name, created_at FROM agent_jobs WHERE status = 'queued' LIMIT 20;
SELECT id, job_id, status, exchange_id, error, completed_at FROM agent_jobs WHERE status = 'running' LIMIT 5;
UPDATE agent_jobs SET status = 'failed', error = 'invalid job: missing prompt', completed_at = time::now(), duration_ms = 0 WHERE status = 'queued' AND (prompt IS NONE OR prompt = '' OR prompt IS NULL OR type::is::string(prompt) = false);
DELETE agent_jobs:1mjlrwiilcvtj2r8bp9q;
DELETE agent_jobs:51dcq9a7cwxopkeuptvc; DELETE agent_jobs:c2e8zpe6qgozad9bu6wl; DELETE agent_jobs:e7j2ayuwols625aj8cr0; DELETE agent_jobs:f2qirhluiux9nkyocs47; DELETE agent_jobs:ohks887p79t85av0tfci; DELETE agent_jobs:z8834bxm8541r71bg6ow;
SELECT status, count() AS count FROM agent_jobs GROUP BY status;
SELECT id, job_id, status, task_name, created_at FROM agent_jobs WHERE status = 'running';
DELETE agent_jobs:32hl9pqsjqbx689d9m4z; DELETE agent_jobs:e4g29x6mshsreq50hlvs; DELETE agent_jobs:otvi281th9c7mqe9neww; DELETE agent_jobs:rlrurrbm3cm13e421jid; DELETE agent_jobs:ulhnkobril7q6cdruo8f;
SELECT status, count() AS count FROM agent_jobs GROUP BY status;
SELECT * FROM curiosity;
-- Migration script for Phase 1: Schema & Data Model
-- Adds Mark fields to thoughts, kg_entities, and kg_observations tables
-- Creates CorrectionEvent table for REMini correction system
-- Add Mark fields to thoughts table
ALTER TABLE thoughts
DEFINE FIELD marked_for ON TABLE thoughts TYPE option<string>; DEFINE FIELD mark_type ON TABLE thoughts TYPE option<string>; DEFINE FIELD mark_note ON TABLE thoughts TYPE option<string>; DEFINE FIELD marked_at ON TABLE thoughts TYPE option<datetime>; DEFINE FIELD marked_by ON TABLE thoughts TYPE option<string>;
DEFINE FIELD marked_for ON TABLE thoughts TYPE option<string>;
DEFINE FIELD marked_for ON TABLE thoughts TYPE option<string>; DEFINE FIELD mark_type ON TABLE thoughts TYPE option<string>; DEFINE FIELD mark_note ON TABLE thoughts TYPE option<string>; DEFINE FIELD marked_at ON TABLE thoughts TYPE option<datetime>; DEFINE FIELD marked_by ON TABLE thoughts TYPE option<string>;
SELECT * FROM thoughts LIMIT 1;
DEFINE FIELD marked_for ON TABLE kg_entities TYPE option<string>; DEFINE FIELD mark_type ON TABLE kg_entities TYPE option<string>; DEFINE FIELD mark_note ON TABLE kg_entities TYPE option<string>; DEFINE FIELD marked_at ON TABLE kg_entities TYPE option<datetime>; DEFINE FIELD marked_by ON TABLE kg_entities TYPE option<string>;
DEFINE FIELD marked_for ON TABLE kg_observations TYPE option<string>; DEFINE FIELD mark_type ON TABLE kg_observations TYPE option<string>; DEFINE FIELD mark_note ON TABLE kg_observations TYPE option<string>; DEFINE FIELD marked_at ON TABLE kg_observations TYPE option<datetime>; DEFINE FIELD marked_by ON TABLE kg_observations TYPE option<string>;
DEFINE TABLE correction_events SCHEMAFULL; DEFINE FIELD id ON TABLE correction_events TYPE record<correction_events>; DEFINE FIELD timestamp ON TABLE correction_events TYPE datetime DEFAULT time::now(); DEFINE FIELD target_id ON TABLE correction_events TYPE string; DEFINE FIELD target_table ON TABLE correction_events TYPE string; DEFINE FIELD previous_state ON TABLE correction_events TYPE object; DEFINE FIELD new_state ON TABLE correction_events TYPE object; DEFINE FIELD initiated_by ON TABLE correction_events TYPE string; DEFINE FIELD reasoning ON TABLE correction_events TYPE string; DEFINE FIELD sources ON TABLE correction_events TYPE array<string>; DEFINE FIELD verification_status ON TABLE correction_events TYPE string; DEFINE FIELD corrects_previous ON TABLE correction_events TYPE option<record<correction_events>>; DEFINE FIELD spawned_by ON TABLE correction_events TYPE option<record<correction_events>>; DEFINE INDEX idx_correction_events_target ON TABLE correction_events FIELDS target_id, target_table; DEFINE INDEX idx_correction_events_timestamp ON TABLE correction_events FIELDS timestamp;
INFO FOR TABLE thoughts;
INFO FOR TABLE correction_events;
CREATE correction_events SET target_id = 'test', target_table = 'thoughts', previous_state = {}, new_state = {}, initiated_by = 'test', reasoning = 'test', sources = ['test'], verification_status = 'test';
INFO FOR TABLE correction_events;
USE NS surreal_mind DB consciousness; SELECT id FROM thoughts LIMIT 3;
USE NS surreal_mind DB consciousness; LET $id = '001db6f2-8a92-41f3-a03f-0cb36d42d238'; SELECT id FROM thoughts WHERE id = type::thing('thoughts', $id);
USE NS surreal_mind DB consciousness; LET $id = '001db6f2-8a92-41f3-a03f-0cb36d42d238'; UPDATE thoughts SET marked_for = 'gemini', mark_type = 'correction', mark_note = 'CLI test', marked_at = time::now(), marked_by = 'cc' WHERE id = type::thing('thoughts', $id) RETURN NONE;
USE NS surreal_mind DB consciousness; SELECT marked_for, mark_type, mark_note, marked_by, marked_at FROM thoughts WHERE id = type::thing('thoughts', '001db6f2-8a92-41f3-a03f-0cb36d42d238');
USE NS surreal_mind DB consciousness; UPDATE thoughts SET marked_for = NONE, mark_type = NONE, mark_note = NONE, marked_at = NONE, marked_by = NONE WHERE id = type::thing('thoughts', '001db6f2-8a92-41f3-a03f-0cb36d42d238') RETURN NONE;
USE NS surreal_mind DB consciousness; SELECT marked_for, mark_type, mark_note, marked_by, marked_at FROM thoughts WHERE id = type::thing('thoughts', '001db6f2-8a92-41f3-a03f-0cb36d42d238');
USE NS surreal_mind DB consciousness; LET $id = '001db6f2-8a92-41f3-a03f-0cb36d42d238'; UPDATE thoughts SET marked_for = 'gemini', mark_type = 'correction', mark_note = 'CLI test', marked_at = time::now(), marked_by = 'cc' WHERE id = type::thing('thoughts', $id) RETURN NONE;
USE NS surreal_mind DB consciousness; SELECT marked_for, mark_type, mark_note, marked_by, marked_at FROM thoughts WHERE id = type::thing('thoughts', '001db6f2-8a92-41f3-a03f-0cb36d42d238');
USE NS surreal_mind DB consciousness; UPDATE thoughts SET marked_for = NONE, mark_type = NONE, mark_note = NONE, marked_at = NONE, marked_by = NONE WHERE id = type::thing('thoughts', '001db6f2-8a92-41f3-a03f-0cb36d42d238') RETURN NONE;
USE NS surreal_mind DB consciousness; SELECT marked_for, mark_type, mark_note, marked_by, marked_at FROM thoughts WHERE id = type::thing('thoughts', '001db6f2-8a92-41f3-a03f-0cb36d42d238');
USE NS surreal_mind DB consciousness; SELECT meta::id(id) as id FROM thoughts LIMIT 1;
USE NS surreal_mind DB consciousness; UPDATE thoughts SET marked_for = "gemini", mark_type = "correction", mark_note = "Test run", marked_at = time::now(), marked_by = "cc" WHERE id = type::thing("thoughts", "001db6f2-8a92-41f3-a03f-0cb36d42d238") RETURN NONE;
